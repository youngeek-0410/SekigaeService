<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Test Page for StudentSheets Model</title>
</head>
<body>

<h2>学生名簿一覧</h2>
<div id="student-sheets"></div>
<h2>新規作成</h2>
<form id="form-post">
    <label for="name-post">Name
        <input type="text" name="name" id="name-post">
    </label>
    <input id="button-post" value="新規作成" type="button">
    {% csrf_token %}
</form>


<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
        crossorigin="anonymous"></script>


<script>
    function getStudentSheets() {
        const url = "http://localhost/student_sheets";
        $.get(url, null, function (data) {
            $("#student-sheets").text(data);
        })
    }

    function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}


    $(function () {
        getStudentSheets()
        $("#button-post").click(function () {
            const url = "http://localhost/student_sheets";
            const data = {'name': $('#name-post').val()}
            console.log(data)
            $.ajax({
                type: 'post',
                url: url,
                headers: {'X-CSRFToken': getCookie('csrftoken')},
                data: JSON.stringify(data),
                success: function(data){
                    $('#name-post').val('')
                    getStudentSheets()
                }
            })
        })

    })
</script>
</body>

</html>